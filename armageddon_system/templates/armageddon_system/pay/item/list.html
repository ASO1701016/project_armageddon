<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>精算管理項目画面</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css"
          integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
</head>
<style>

    h1 {
        text-align: center;
        position: relative;
        bottom: 130px;
    }

    table {
        position: relative;
        left: 50px;
        top: 20px;
    }

    * {
        -webkit-transition-property: all;
        -webkit-transition-duration: .2s;
        -moz-transition-timing-function: cubic-bezier(100, 50, 21, 6);
        -moz-transition-property: all;
    }

    body {
        font-size: 20px;
        padding: 75px;
        font-family: 'Oswald', sans-serif;
    }

    #items p {
        margin-bottom: 30px;
    }

    button {
        position: relative;
        left: 633px;
        top: 140px;

    }

    #school_num p {
        position: relative;
        top: 40px;
        right: 100px;
    }

    #app_name p {
        position: relative;
        top: 40px;
        right: 100px;
    }


    #app_form p {
        position: relative;
        top: 67px;
        left: 450px;
    }

    form p {
        font-size: 20px;
        position: relative;
        left: 200px;
        top: 100px;
    }


    input[type="ID"],
    input[type="password"] {
        width: 300px;
        padding: 4px;
        font-size: 14px;
    }

    /*QA管理画面*/
    .panel ul {
        text-align: left;
        color: #000;
    }

    .panel li {
        display: inline-block;
        vertical-align: middle;
        color: #000;
        position: relative;
        right: 52px;
        bottom: 122px;
        margin: 50px;
    }

    .panel a {
        font-weight: bold;
        position: relative;
        top: 20px;
        left: 110px;
        color: #000;
        text-decoration: none;
    }

    .panel a::after {
        position: absolute;
        bottom: -4px;
        left: 0;
        content: '';
        width: 100%;
        height: 2px;
        background: #008000;
        transform: scale(0, 1);
        transform-origin: left top;
        transition: transform .3s;
    }

    .panel a:hover::after {
        transform: scale(1, 1);
    }

    table {
        position: relative;
        top: 30px;
        left: -35px;
    }

    #systems {
        position: relative;
        top: 2px;
    }

    textarea {
        width: 400px;
        height: 170px;
    }

</style>
<body>
<nav>
    <div class="panel">
        <ul>
            <li><a href="#" onclick="window.history.back(); return false;">戻る</a></li>
            <li><a href="/pay/item/list">精算項目</a></li>
            <li><a href="/linebot/qa/list">LINEBOT/QA管理</a></li>
            <li><a href="/linebot/msg/list">メッセージ管理</a></li>
            <li><a href="#">ログアウト</a></li>
        </ul>
    </div>
</nav>

<h1>精算管理項目</h1>


<div id="systems">
        <div><input type="button" id="add" name="add" value="追加" onclick="appendRow()"></div>
        <table border="1" id="tbl">
            <tr>
                <th style="text-align:right; width:40px;">No.</th>
                <th style="">申請書名</th>
                <th style="">金額</th>
                <th style="">日数</th>
                <th style="width:40px;"></th>
                <th style="width:40px;"></th>
                <th style="width:40px;"></th>
            </tr>
            {% for form in forms %}
                <form id="frm" name="frm" method="POST" action="./qr">
                    {% csrf_token %}
                    <tr>
                        <td style="text-align:right; width:40px;"><span class="seqno">1</span></td>
                        <td style=""><input class="inpval" type="text" id="txt1"
                                            name="txt1" value= {{ form.form_name }} size="25" style="border:none"></td>
                        <td style=""><input class="inpval" type="text" id="txt2"
                                            name="txt2" value={{ form.fee }} size="25" style="border:none"></td>
                        <td style=""><input class="inpval" type="text" id="txt3"
                                            name="txt3" value={{ form.issuance_days }} size="25" style="border:none"></td>
                        <td style="width:40px;"><input class="edtbtn" type="button" id="edtBtn1" value="編集"
                                                       onclick="editRow(this)"></td>
                        <td style="width:40px;"><input class="delbtn" type="button" id="delBtn1" value="削除"
                                                       onclick="deleteRow(this)"></td>
                        <td style="width:40px;"><input class="qrbtn" type="submit" id="qrBtn1" value="QR表示"></td>
                    </tr>
                </form>
            {% endfor %}
        </table>
</div>
<script>
    function appendRow() {
        var objTBL = document.getElementById("tbl");
        if (!objTBL)
            return;

        var count = objTBL.rows.length;

        // 最終行に新しい行追加
        var row = objTBL.insertRow(count);

        // 列追加
        var c1 = row.insertCell(0);
        var c2 = row.insertCell(1);
        var c3 = row.insertCell(2);
        var c4 = row.insertCell(3);
        var c5 = row.insertCell(4);
        var c6 = row.insertCell(5);
        var c7 = row.insertCell(6);

        // 各列にスタイル設定
        c1.style.cssText = "text-align:right; width:40px;";
        c2.style.cssText = "";
        c3.style.cssText = "";
        c4.style.cssText = "";
        c5.style.cssText = "width:40px;";
        c6.style.cssText = "width:40px;";
        c7.style.cssText = "width:40px;";


        // 各列に表示内容を設定
        c1.innerHTML = '<span class="seqno">' + count + '</span>';
        c2.innerHTML = '<input class="inpval" type="text"   id="txt1' + count + '" name="txt' + count + '" value="" size="30" style="border:1px solid #888;">';
        c3.innerHTML = '<input class="inpval" type="text"   id="txt2' + count + '" name="txt' + count + '" value="" size="30" style="border:1px solid #888;">';
        c4.innerHTML = '<input class="inpval" type="text"   id="txt3' + count + '" name="txt' + count + '" value="" size="30" style="border:1px solid #888;">';
        c5.innerHTML = '<input class="edtbtn" type="button" id="edtBtn' + count + '" value="編集" onclick="function tab(e)">';
        c6.innerHTML = '<input class="delbtn" type="button" id="delBtn' + count + '" value="削除" onclick="deleteRow(this)">';
        c7.innerHTML = '<input class="qrbtn" type="button" id="qrBtn' + count + '" value="QR出力" onclick="QROutput(this)">';

        // 追加した行の入力フィールドにフォーカスを設定
        var objInp = document.getElementById("txt1" + count);
        if (objInp)
            objInp.focus();
    }

    /*
     * deleteRow: 削除ボタン該当行を削除
     */
    function deleteRow(obj) {
        // 確認
        if (!confirm("この行を削除しますか？"))
            return;

        if (!obj)
            return;

        var objTR = obj.parentNode.parentNode;
        var objTBL = objTR.parentNode;

        if (objTBL)
            objTBL.deleteRow(objTR.sectionRowIndex);

        // <span> 行番号ふり直し
        var tagElements = document.getElementsByTagName("span");
        if (!tagElements)
            return false;

        var seq = 1;
        for (var i = 0; i < tagElements.length; i++) {
            if (tagElements[i].className.match("seqno"))
                tagElements[i].innerHTML = seq++;
        }

        // id/name ふり直し
        var tagElements = document.getElementsByTagName("input");
        if (!tagElements)
            return false;
        var seq = 1;
        for (var i = 0; i < tagElements.length; i++) {
            if (tagElements[i].className.match("inpval")) {
                tagElements[i].setAttribute("id", "txt" + seq);
                tagElements[i].setAttribute("name", "txt" + seq);
                ++seq;
            }
        }
        seq = 1;
        for (var i = 0; i < tagElements.length; i++) {
            if (tagElements[i].className.match("edtbtn")) {
                tagElements[i].setAttribute("id", "edtBtn" + seq);
                ++seq;
            }
        }

        // <input type="button" id="delBtnN">
        seq = 1;
        for (var i = 0; i < tagElements.length; i++) {
            if (tagElements[i].className.match("delbtn")) {
                tagElements[i].setAttribute("id", "delBtn" + seq);
                ++seq;
            }
        }
    }

    /*
     *編集ボタン該当行の内容を入力・編集、モード切り替え
     */
    function tab(e) {
        if (e.which == 13) {
            e.target.nextSibling.nextSibling.focus();
            e.preventDefault();
        }
    }

    var inputs = document.getElementsByTagName('input');
    for (var x = 0; x < inputs.length; x++) {
        var input = inputs[x];
        input.onkeypress = tab;
    }


</script>
</body>
</html>